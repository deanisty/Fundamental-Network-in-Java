正如前面提到的那样，TCP通过实现双向可靠的数据流来达到在任意方向上传输任意数量的数据的能力，也可以同时在两个方向上传输。

## 3.2.1 特性
TCP保证了被接收的数据会被自动的“确认”，“排序”和必要的“重发”。应用程序不会接收到顺序被破坏的数据，或者数据“空洞”。

数据的传输会自动根据途经网络的能力调整发送速度，未收到确认的数据会根据需要重新发送。

在不会导致网络拥堵和保证所有网络用户公平的前提下，TCP会使用所有可用的带宽。

TCP通过调整负载和路由得以快速和可靠的适应变化的网络环境。

TCP实现了一个“协商建立连接”机制用于在客户端的连接请求建立之前，保证服务端已经启动而且正在运行，并且保证服务端的主机接收了客户端的连接。

TCP实现了一个“协商断开连接”机制用于在连接被最终断开之前，保证所有没有发送或接收完的数据传输完成。

## 3.2.2 成本
上述所有TCP的特性都有与之相关的代价。包括计算代价，协议代价和时间代价。

1. 协商建立连接需要三次数据包的交换
   * 客户端发送 SYN 数据包
   * 服务端回复 SYN/ACK 数据包
   * 然后客户端回复 ACK 数据包
   
   如果第一个SYN数据包没有收到响应，就会以不断增加的时间间隔进行重试。第一次重试的时间间隔和具体的实现有关，通常是3-6秒，并且每次失败后时间至少会加倍。尝试建立连接的总耗时也取决于具体实现，不过通常会限制在75秒内或者不超过3次重试。因此，一次典型的完全失败的连接尝试总共消耗的时间可能是 6+12+24=42 秒。
2. 协商断开连接包含四次数据包的交换
   连接双发各发送一次 FIN 以及对接收到的 FIN 的ACK回复。 
3. 数据排序，确认，和频率的控制都需要消耗计算能力，其中就包括需要维护一个数据包当前往返时间的统计平滑估计量。
4. 为了实现拥塞回避，需要为重新传输和慢启动传输维护一个以指数方式增长的重试计时器（指数回避），这就意味着尽管最终发送速度会以指数方式增长到最大，但是最开始的少量数据包通常会以次优的速度发送。


## 3.2.3 TCP和请求-应答会话
TCP是用来做大量数据传输的。对于一个简单的请求-应答会话来说，理论上它只需要在两个方向上分别发送一个IP数据包，这样的话系统的整体效率并不是很高，因为事实上至少需要交换9个TCP报文段，就像图3.2中的时序图描述的那样：

![figure3.2](/images/image_3.2.png)
> 图3.2 请求-应答会话中TCP报文段的交换

每个方向上的数据包都可能会被调整发送频率并且要满足“慢启动”的要求，但是确认数据包除外。

为了缓解上述问题，如果应答数据包可以很快发出的话，可以把对请求数据包的ACK合并到应答数据包中，并且如果断开连接的FIN数据包能够立即发送的话，对回复数据包的ACK也可以被合并到断开连接的FIN包中。